@model IEnumerable<ST10281011_PROG7311_POE_PART_2.Models.Product>

@{
    ViewData["Title"] = "Products";
}

<div class="page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <h1 class="page-title">Product <span class="text-gradient">Marketplace</span></h1>
                <p class="page-subtitle">Browse and manage sustainable agricultural products</p>
            </div>
        </div>
    </div>
</div>

<div class="container py-5">
    @if (User.IsInRole("Employee"))
    {
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="fas fa-filter me-2"></i>Filter Products</h5>
                        <form method="get" class="row g-3">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="startDate" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="startDate" name="startDate" placeholder="Start Date">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="endDate" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="endDate" name="endDate" placeholder="End Date">

                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="productType" class="form-label">Product Category</label>
                                    <select class="form-select form-control-lg" id="productType" name="productType">
                                        <option value="" selected>All Categories</option>
                                        @foreach (var category in Enum.GetValues(typeof(ProductCategories)))
                                        {
                                            <option value="@category">@category</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-12 text-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search me-2"></i>Apply Filters
                                </button>
                                <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
                                    <i class="fas fa-redo me-2"></i>Reset
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }

    @if (User.IsInRole("Farmer"))
    {
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0"><i class="fas fa-plus-circle me-2"></i>Add New Product</h5>
                        <a asp-action="CreateProduct" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Add Product
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }

    <div class="row">
        @if (!Model.Any())
        {
            <div class="col-12">
                <div class="alert alert-info" role="alert">
                    <i class="fas fa-info-circle me-2"></i>No products found. Please adjust your filters or add new products.
                </div>
            </div>
        }
        else
        {
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Category</th>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Date</th>
                                        <th>Price</th>
                                        <th>Quantity</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <td>
                                                <span class="badge bg-success rounded-pill">@item.ProductType</span>
                                            </td>
                                            <td>
                                                @{
                                                    var iconClass = item.ProductType.ToString() switch
                                                    {
                                                        "Vegetables" => "fa-carrot",
                                                        "Fruits" => "fa-apple-alt",
                                                        "Grains" => "fa-wheat",
                                                        "Dairy" => "fa-cheese",
                                                        "Meat" => "fa-drumstick-bite",
                                                        "Poultry" => "fa-egg",
                                                        _ => "fa-leaf"
                                                    };
                                                }
                                                <i class="fas @iconClass me-2 text-success"></i>
                                                <strong>@item.Name</strong>
                                            </td>
                                            <td>@(item.Description?.Length > 50 ? item.Description.Substring(0, 50) + "..." : item.Description)</td>
                                            <td>@item.ProductionDate.ToString("MMM dd, yyyy")</td>
                                            <td>R @item.Price</td>
                                            <td>@item.Quantity @item.UnitOfMeasure</td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a asp-action="Details" asp-route-id="@item.ProductId" class="btn btn-outline-primary">
                                                        <i class="fas fa-info-circle"></i>
                                                    </a>
                                                    @if (User.IsInRole("Farmer"))
                                                    {
                                                        <a asp-action="Edit" asp-route-id="@item.ProductId" class="btn btn-outline-secondary">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                        <a asp-action="Delete" asp-route-id="@item.ProductId" class="btn btn-outline-danger">
                                                            <i class="fas fa-trash-alt"></i>
                                                        </a>
                                                    }
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<style>
    .page-header {
        background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        padding: 4rem 0 2rem;
        margin-bottom: 2rem;
        color: white;
        border-radius: 0 0 1rem 1rem;
    }

    .table th {
        font-weight: 600;
    }

    .table td {
        vertical-align: middle;
    }

    .bg-gradient-primary {
        background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
    }

    /* Form styling */
    .form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
        display: block;
    }

    .form-control-lg {
        height: calc(3.5rem + 2px);
        padding: 0.5rem 1rem;
        font-size: 1rem;
    }

    /* Ensure consistent heights for all form controls */
    .form-control {
        height: calc(3.5rem + 2px);
    }

    /* Exception for textarea */
    textarea.form-control {
        height: auto;
    }
</style>